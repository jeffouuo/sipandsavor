# 線上支付測試功能指南

## 功能概述

已為購物車結帳功能添加了線上支付測試功能。這是一個**模擬支付系統**，用於測試支付流程，不需要真實的支付網關。

## 功能特點

1. **支付方式選擇**：支持多種支付方式
   - 信用卡
   - LINE Pay
   - 現金支付（現場付款）

2. **模擬支付流程**：
   - 支付處理動畫
   - 模擬支付處理步驟
   - 支付成功/失敗處理
   - 測試控制按鈕（用於測試不同場景）

3. **完整的訂單流程**：
   - 訂單摘要顯示
   - 支付方式選擇
   - 支付處理
   - 訂單提交

## 使用流程

### 1. 添加商品到購物車
在菜單頁面選擇商品並添加到購物車。

### 2. 點擊結帳
點擊購物車中的「結帳」按鈕。

### 3. 選擇支付方式
系統會跳轉到支付選擇頁面（`payment.html`），您可以：
- 查看訂單摘要
- 選擇支付方式（信用卡、LINE Pay 或現金）

### 4. 處理支付
- **線上支付**：選擇信用卡或 LINE Pay 後，會跳轉到支付處理頁面
- **現金支付**：選擇現金支付後，會直接提交訂單（現場付款）

### 5. 支付處理頁面
在支付處理頁面（`payment-process.html`）：
- 顯示支付處理動畫和狀態
- 模擬支付處理過程（約 6-8 秒）
- 自動完成支付並提交訂單

### 6. 測試控制
在支付失敗時，可以使用測試控制按鈕：
- **模擬成功**：模擬支付成功
- **模擬失敗**：模擬支付失敗

## 技術實現

### 文件結構
- `payment.html` - 支付方式選擇頁面
- `payment-process.html` - 支付處理頁面
- `script-enhanced.js` - 修改了結帳流程，跳轉到支付選擇頁面

### 數據流程
1. 用戶點擊結帳 → 驗證購物車數據
2. 保存訂單數據到 `localStorage`（`pendingOrder`）
3. 跳轉到 `payment.html`
4. 用戶選擇支付方式
5. 跳轉到 `payment-process.html`（線上支付）或直接提交（現金支付）
6. 模擬支付處理
7. 提交訂單到後端 API
8. 清除 `localStorage` 中的待處理訂單

## 測試建議

### 測試場景 1：信用卡支付
1. 添加商品到購物車
2. 點擊結帳
3. 選擇「信用卡」
4. 點擊「前往支付」
5. 觀察支付處理過程
6. 確認訂單成功提交

### 測試場景 2：LINE Pay 支付
1. 重複上述步驟，但選擇「LINE Pay」
2. 觀察不同的支付方式顯示

### 測試場景 3：現金支付
1. 選擇「現金支付（現場付款）」
2. 確認直接提交訂單，不經過支付處理頁面

### 測試場景 4：支付失敗處理
1. 在支付處理頁面等待支付失敗（約 10% 機率）
2. 或使用「模擬失敗」按鈕
3. 使用「模擬成功」按鈕測試成功流程

## 注意事項

1. **這是模擬支付系統**：不會進行真實的支付處理
2. **測試環境**：所有支付都是模擬的，用於測試流程
3. **數據保存**：訂單數據會保存在 `localStorage` 中，直到訂單提交成功
4. **瀏覽器兼容性**：建議使用現代瀏覽器（Chrome、Firefox、Safari、Edge）

## 未來擴展

如果需要接入真實的支付網關，可以：
1. 在 `payment-process.html` 的 `simulatePayment()` 函數中替換為真實的支付 API 調用
2. 添加支付回調處理
3. 實現支付驗證和確認機制

## 問題排查

### 問題：無法跳轉到支付頁面
- 檢查 `payment.html` 文件是否存在
- 檢查瀏覽器控制台是否有錯誤

### 問題：訂單數據丟失
- 檢查 `localStorage` 是否被清除
- 確認瀏覽器支持 `localStorage`

### 問題：支付處理頁面顯示錯誤
- 檢查 URL 參數是否正確
- 檢查 `localStorage` 中的 `pendingOrder` 數據


