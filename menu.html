<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£²æ–™èœå–® - é£²èŒ¶è¶£</title>
    <link rel="icon" type="image/webp" href="/images/sipandsavor.webp">
    <link rel="shortcut icon" type="image/webp" href="/images/sipandsavor.webp">
    <link rel="stylesheet" href="style-optimized.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <header>
        <!-- æ‰‹æ©Ÿå…ƒä»¶ -->
        <button class="menu" id="hamburgerBtn">&#9776;</button>
        
        <a href="index.html"><h1>é£²èŒ¶è¶£</h1></a>
    
        <!-- æ¡Œé¢å°èˆª -->
        <nav class="desktop-nav">
            <ul>
                <li><a href="news.html">æœ€æ–°æ¶ˆæ¯</a></li>
                <li class="dropdown">
                    <a href="javascript:void(0);">é£²æ–™èœå–®</a>
                    <ul class="dropdown-menu">
                        <li><a href="menu.html#coffee">å’–å•¡</a></li>
                        <li><a href="menu.html#tea">èŒ¶é¡</a></li>
                    </ul>
                </li>
                <li><a href="about.html">é—œæ–¼æˆ‘å€‘</a></li>
                <li><a href="stores.html">é–€å¸‚æ“šé»</a></li>
            </ul>
        </nav>
    
        <!-- è³¼ç‰©è»Šåœ–æ¨™ -->
        <div class="cart-icon" id="cartIcon">
            <span class="material-icons">shopping_cart</span>
            <span class="cart-count">0</span>
        </div>

        <!-- è³¼ç‰©è»Šå´é‚Šæ¬„ -->
        <div class="cart-sidebar" id="cartSidebar">
            <div class="cart-header">
                <h3>è³¼ç‰©è»Š</h3>
                <button class="close-cart" id="closeCart">&times;</button>
            </div>
            <div class="cart-items">
                <!-- è³¼ç‰©è»Šé …ç›®å°‡é€šé JavaScript å‹•æ…‹æ·»åŠ  -->
            </div>
            <div class="cart-footer">
                <div class="cart-total">
                    <span>ç¸½è¨ˆï¼š</span>
                    <span class="total-amount">NT$ 0</span>
                </div>
                <button class="checkout-btn">çµå¸³</button>
            </div>
        </div>
    
        <!-- æ‰‹æ©Ÿèœå–® -->
        <nav id="mobileMenu">
            <ul>
                <li><a href="news.html">æœ€æ–°æ¶ˆæ¯</a></li>
                <li><a href="menu.html">é£²æ–™èœå–®</a></li>
                <li><a href="about.html">é—œæ–¼æˆ‘å€‘</a></li>
                <li><a href="stores.html">é–€å¸‚æ“šé»</a></li>
            </ul>
        </nav>
    </header>
    
    <main>
        <section class="menu-grid">
            <div class="menu-container">
                <!-- å’–å•¡é¡ -->
                <div class="menu-category" id="coffee" data-category="coffee">
                    <h2 class="category-title">å’–å•¡</h2>
                    <div class="category-items">
                        <div class="menu-item" data-name="ç¾å¼å’–å•¡" data-price="45">
                            <img src="images/americano.webp" alt="ç¾å¼å’–å•¡" loading="lazy" class="menu-image">
                            <div class="menu-info">
                                <h3>ç¾å¼å’–å•¡</h3>
                                <p class="menu-description">ç´”ç²¹çš„å’–å•¡é¦™æ°£</p>
                                <p class="menu-price">NT$ 45</p>
                                <button class="customize-btn">è³¼è²·</button>
                            </div>
                        </div>
                        
                        <div class="menu-item" data-name="æ‹¿éµå’–å•¡" data-price="60">
                            <img src="images/latte.webp" alt="æ‹¿éµå’–å•¡" loading="lazy" class="menu-image">
                            <div class="menu-info">
                                <h3>æ‹¿éµå’–å•¡</h3>
                                <p class="menu-description">é¦™æ¿ƒå¥¶é¦™èˆ‡å’–å•¡çš„å®Œç¾èåˆ</p>
                                <p class="menu-price">NT$ 60</p>
                                <button class="customize-btn">è³¼è²·</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- èŒ¶é¡ -->
                <div class="menu-category" id="tea" data-category="tea">
                    <h2 class="category-title">èŒ¶é¡</h2>
                    <div class="category-items">
                        <div class="menu-item" data-name="æ˜Ÿè¾°å¥¶èŒ¶" data-price="50">
                            <img src="images/milk tea.webp" alt="æ˜Ÿè¾°å¥¶èŒ¶" loading="lazy" class="menu-image">
                            <div class="menu-info">
                                <h3>æ˜Ÿè¾°å¥¶èŒ¶</h3>
                                <p class="menu-description">æ¯ä¸€å£éƒ½æ˜¯ä¸€å ´æ˜Ÿè¾°ä¹‹æ—…</p>
                                <p class="menu-price">NT$ 50</p>
                                <button class="customize-btn">è³¼è²·</button>
                            </div>
                        </div>
                        
                        <div class="menu-item" data-name="å¤¢å¹»æª¸èŒ¶" data-price="60">
                            <img src="images/lemon black tea.webp" alt="å¤¢å¹»æª¸èŒ¶" loading="lazy" class="menu-image">
                            <div class="menu-info">
                                <h3>å¤¢å¹»æª¸èŒ¶</h3>
                                <p class="menu-description">é‡‹æ”¾å…§å¿ƒçš„æ¸…æ–°åŠ›é‡</p>
                                <p class="menu-price">NT$ 60</p>
                                <button class="customize-btn">è³¼è²·</button>
                            </div>
                        </div>
                        
                        <div class="menu-item" data-name="ç¶ éœ§å¥¶ç¶ " data-price="55">
                            <img src="images/milkgreen.webp" alt="ç¶ éœ§å¥¶ç¶ " loading="lazy" class="menu-image">
                            <div class="menu-info">
                                <h3>ç¶ éœ§å¥¶ç¶ </h3>
                                <p class="menu-description">å¸¶ä¾†ä¸€æŠ¹æ¸…æ–°</p>
                                <p class="menu-price">NT$ 55</p>
                                <button class="customize-btn">è³¼è²·</button>
                            </div>
                        </div>
                        
                        <div class="menu-item" data-name="å†·èƒçƒé¾" data-price="65">
                            <img src="images/coldtea.webp" alt="å†·èƒçƒé¾" loading="lazy" class="menu-image">
                            <div class="menu-info">
                                <h3>å†·èƒçƒé¾</h3>
                                <p class="menu-description">ç¶“é12å°æ™‚ä½æº«æ…¢é‡€</p>
                                <p class="menu-price">NT$ 65</p>
                                <button class="customize-btn">è³¼è²·</button>
                            </div>
                        </div>
                        
                        <div class="menu-item" data-name="ç¿¡ç¿ ç´…èŒ¶" data-price="30">
                            <img src="images/blacktea1.webp" alt="ç¿¡ç¿ ç´…èŒ¶" loading="lazy" class="menu-image">
                            <div class="menu-info">
                                <h3>ç¿¡ç¿ ç´…èŒ¶</h3>
                                <p class="menu-description">é†‡åšå›ç”˜ï¼Œé¦™æ°£å››æº¢</p>
                                <p class="menu-price">NT$ 30</p>
                                <button class="customize-btn">è³¼è²·</button>
                            </div>
                        </div>
                        
                        <div class="menu-item" data-name="èŠ’æœå†°èŒ¶" data-price="70">
                            <img src="images/mango-iced.webp" alt="èŠ’æœå†°èŒ¶" loading="lazy" class="menu-image">
                            <div class="menu-info">
                                <h3>èŠ’æœå†°èŒ¶</h3>
                                <p class="menu-description">å¤æ—¥å¿…å‚™çš„æ¸…çˆ½æ»‹å‘³</p>
                                <p class="menu-price">NT$ 70</p>
                                <button class="customize-btn">è³¼è²·</button>
                            </div>
                        </div>
                        
                        <div class="menu-item" data-name="æ¡‚èŠ±çƒé¾" data-price="55">
                            <img src="images/Osmanthus Oolong Tea.webp" alt="æ¡‚èŠ±çƒé¾" loading="lazy" class="menu-image">
                            <div class="menu-info">
                                <h3>æ¡‚èŠ±çƒé¾</h3>
                                <p class="menu-description">æ·¡é›…èŠ±é¦™ï¼Œå›ç”˜æŒä¹…</p>
                                <p class="menu-price">NT$ 55</p>
                                <button class="customize-btn">è³¼è²·</button>
                            </div>
                        </div>
                        
                        <div class="menu-item" data-name="è“æœæ°£æ³¡é£²" data-price="75">
                            <img src="images/berry-sparkling.webp" alt="è“æœæ°£æ³¡é£²" loading="lazy" class="menu-image">
                            <div class="menu-info">
                                <h3>è“æœæ°£æ³¡é£²</h3>
                                <p class="menu-description">æ¸…çˆ½æ°£æ³¡èˆ‡è“æœçš„ç¹½ç´›é‚‚é€…</p>
                                <p class="menu-price">NT$ 75</p>
                                <button class="customize-btn">è³¼è²·</button>
                            </div>
                        </div>
                        
                        <div class="menu-item" data-name="ç¶ èŒ¶" data-price="30">
                            <img src="images/greentea.webp" alt="ç¶ èŒ¶" loading="lazy" class="menu-image">
                            <div class="menu-info">
                                <h3>ç¶ èŒ¶</h3>
                                <p class="menu-description">æ¸…æ–°æ·¡é›…ï¼Œå›ç”˜æ‚ é•·</p>
                                <p class="menu-price">NT$ 30</p>
                                <button class="customize-btn">è³¼è²·</button>
                            </div>
                        </div>
                        
                        <div class="menu-item" data-name="ç´…èŒ¶" data-price="30">
                            <img src="images/blacktea.webp" alt="ç´…èŒ¶" loading="lazy" class="menu-image">
                            <div class="menu-info">
                                <h3>ç´…èŒ¶</h3>
                                <p class="menu-description">é†‡åšå›ç”˜ï¼Œé¦™æ°£å››æº¢</p>
                                <p class="menu-price">NT$ 30</p>
                                <button class="customize-btn">è³¼è²·</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- å®¢è£½åŒ–é¸é …å½ˆå‡ºé¢æ¿ -->
    <div class="customize-modal" id="customizeModal">
        <div class="customize-content">
            <div class="customize-header">
                <h3 id="customizeDrinkName">å®¢è£½åŒ–é£²æ–™</h3>
                <button class="close-customize" id="closeCustomize">&times;</button>
            </div>
            
            <div class="customize-body">
                <!-- ç³–é‡é¸æ“‡ -->
                <div class="customize-section">
                    <h4>ç³–é‡</h4>
                    <div class="option-group">
                        <label class="option-item">
                            <input type="radio" name="sugar" value="ç„¡ç³–" checked>
                            <span class="option-text">ç„¡ç³–</span>
                        </label>
                        <label class="option-item">
                            <input type="radio" name="sugar" value="å¾®ç³–">
                            <span class="option-text">å¾®ç³–</span>
                        </label>
                        <label class="option-item">
                            <input type="radio" name="sugar" value="åŠç³–">
                            <span class="option-text">åŠç³–</span>
                        </label>
                        <label class="option-item">
                            <input type="radio" name="sugar" value="å°‘ç³–">
                            <span class="option-text">å°‘ç³–</span>
                        </label>
                        <label class="option-item">
                            <input type="radio" name="sugar" value="å…¨ç³–">
                            <span class="option-text">å…¨ç³–</span>
                        </label>
                    </div>
                </div>

                <!-- å†°é‡é¸æ“‡ -->
                <div class="customize-section">
                    <h4>å†°é‡</h4>
                    <div class="option-group">
                        <label class="option-item">
                            <input type="radio" name="ice" value="å»å†°">
                            <span class="option-text">å»å†°</span>
                        </label>
                        <label class="option-item">
                            <input type="radio" name="ice" value="å¾®å†°">
                            <span class="option-text">å¾®å†°</span>
                        </label>
                        <label class="option-item">
                            <input type="radio" name="ice" value="å°‘å†°">
                            <span class="option-text">å°‘å†°</span>
                        </label>
                        <label class="option-item">
                            <input type="radio" name="ice" value="æ­£å¸¸å†°" checked>
                            <span class="option-text">æ­£å¸¸å†°</span>
                        </label>
                        <label class="option-item" id="hotOption" style="display: none;">
                            <input type="radio" name="ice" value="ç†±é£²">
                            <span class="option-text">ç†±é£²</span>
                        </label>
                    </div>
                </div>

                <!-- åŠ æ–™é¸æ“‡ -->
                <div class="customize-section" id="toppingsSection">
                    <h4>åŠ æ–™ (æ¯é … +NT$ 15)</h4>
                    <div class="option-group">
                        <label class="option-item">
                            <input type="checkbox" name="toppings" value="çç ">
                            <span class="option-text">çç </span>
                        </label>
                        <label class="option-item">
                            <input type="checkbox" name="toppings" value="æ¤°æœ">
                            <span class="option-text">æ¤°æœ</span>
                        </label>
                        <label class="option-item">
                            <input type="checkbox" name="toppings" value="å¸ƒä¸">
                            <span class="option-text">å¸ƒä¸</span>
                        </label>
                        <label class="option-item">
                            <input type="checkbox" name="toppings" value="ä»™è‰">
                            <span class="option-text">ä»™è‰</span>
                        </label>
                        <label class="option-item">
                            <input type="checkbox" name="toppings" value="æ„›ç‰">
                            <span class="option-text">æ„›ç‰</span>
                        </label>
                        <label class="option-item">
                            <input type="checkbox" name="toppings" value="å¯’å¤©">
                            <span class="option-text">å¯’å¤©</span>
                        </label>
                    </div>
                </div>

                <!-- ç‰¹æ®Šè¦æ±‚ -->
                <div class="customize-section">
                    <h4>ç‰¹æ®Šè¦æ±‚</h4>
                    <textarea class="special-request-input" placeholder="è«‹è¼¸å…¥ç‰¹æ®Šè¦æ±‚ (é¸å¡«)"></textarea>
                </div>

                <!-- åƒ¹æ ¼é¡¯ç¤º -->
                <div class="customize-price">
                    <span>ç¸½åƒ¹ï¼š</span>
                    <span class="customize-total-price">NT$ 0</span>
                </div>
            </div>

            <div class="customize-footer">
                <button class="add-to-cart-btn" id="addToCartBtn">åŠ å…¥è³¼ç‰©è»Š</button>
                <button class="cancel-customize-btn" id="cancelCustomizeBtn">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <footer>
        <p>Copyright â— 2025 é£²èŒ¶è¶£ All Rights Reserved.</p>
        <!-- éš±è—çš„ç®¡ç†å…¥å£ -->
        <div class="hidden-admin-entry" id="hiddenAdminEntry">
            <div class="admin-entry-trigger" id="adminEntryTrigger">
                <span class="admin-hint">ğŸ‘‘</span>
            </div>
            <div class="admin-entry-modal" id="adminEntryModal">
                <div class="admin-entry-content">
                    <h3>ç®¡ç†å“¡å…¥å£</h3>
                    <p>ç¢ºèªé€²å…¥ç®¡ç†å¾Œå°ï¼Ÿ</p>
                    <div class="admin-entry-buttons">
                        <button id="adminLoginBtn">é€²å…¥å¾Œå°</button>
                        <button id="adminCancelBtn">å–æ¶ˆ</button>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script src="script-enhanced.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

    <!-- éš±è—ç®¡ç†å…¥å£åŠŸèƒ½ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const trigger = document.getElementById('adminEntryTrigger');
            const modal = document.getElementById('adminEntryModal');
            const loginBtn = document.getElementById('adminLoginBtn');
            const cancelBtn = document.getElementById('adminCancelBtn');
            
            let clickCount = 0;
            let clickTimer = null;
            
            // é›™æ“Šè§¸ç™¼å™¨é¡¯ç¤ºç®¡ç†å…¥å£
            if (trigger) {
                trigger.addEventListener('click', function() {
                    clickCount++;
                    
                    if (clickCount === 1) {
                        clickTimer = setTimeout(() => {
                            clickCount = 0;
                        }, 300);
                    } else if (clickCount === 2) {
                        clearTimeout(clickTimer);
                        clickCount = 0;
                        
                        // æ·»åŠ å‹•ç•«æ•ˆæœ
                        trigger.classList.add('double-clicked');
                        setTimeout(() => {
                            trigger.classList.remove('double-clicked');
                        }, 500);
                        
                        // é¡¯ç¤ºç®¡ç†å…¥å£
                        showAdminEntry();
                    }
                });
            }
            
            // é¡¯ç¤ºç®¡ç†å…¥å£
            function showAdminEntry() {
                modal.style.display = 'flex';
            }
            
            // éš±è—ç®¡ç†å…¥å£
            function hideAdminEntry() {
                modal.style.display = 'none';
            }
            
            // ç™»å…¥æŒ‰éˆ•äº‹ä»¶
            if (loginBtn) {
                loginBtn.addEventListener('click', function() {
                                    // è·³è½‰åˆ°æ­£å¼çš„ç™»éŒ„é é¢é€²è¡Œèº«ä»½é©—è­‰
                window.location.href = 'login.html?redirect=admin';
                });
            }
            
            // å–æ¶ˆæŒ‰éˆ•äº‹ä»¶
            if (cancelBtn) {
                cancelBtn.addEventListener('click', hideAdminEntry);
            }
            
            // é»æ“ŠèƒŒæ™¯é—œé–‰
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        hideAdminEntry();
                    }
                });
            }
        });
    </script>

    <!-- åˆ†é¡ç¯©é¸åŠŸèƒ½ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const menuCategories = document.querySelectorAll('.menu-category');
            
            // ç¯©é¸åŠŸèƒ½
            function filterCategories(category) {
                console.log('ç¯©é¸é¡åˆ¥:', category); // èª¿è©¦ç”¨
                menuCategories.forEach(categoryEl => {
                    if (category === 'all' || categoryEl.dataset.category === category) {
                        categoryEl.classList.remove('hidden', 'fade-out');
                        categoryEl.style.display = 'block';
                        categoryEl.style.opacity = '1';
                        categoryEl.style.transform = 'translateY(0)';
                    } else {
                        categoryEl.classList.add('hidden');
                        categoryEl.style.display = 'none';
                    }
                });
            }
            
            // URLéŒ¨é»è™•ç†
            function handleUrlAnchor() {
                const hash = window.location.hash;
                console.log('ç•¶å‰éŒ¨é»:', hash); // èª¿è©¦ç”¨
                
                if (hash) {
                    const category = hash.substring(1); // ç§»é™¤ #
                    if (category === 'coffee' || category === 'tea') {
                        filterCategories(category);
                    } else {
                        filterCategories('all');
                    }
                } else {
                    filterCategories('all');
                }
            }
            
            // é é¢è¼‰å…¥æ™‚è™•ç†URLéŒ¨é»
            handleUrlAnchor();
            
            // ç›£è½URLè®ŠåŒ–
            window.addEventListener('hashchange', handleUrlAnchor);
        });
    </script>

    <!-- å®¢è£½åŒ–åŠŸèƒ½ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const customizeModal = document.getElementById('customizeModal');
            const customizeDrinkName = document.getElementById('customizeDrinkName');
            const customizeTotalPrice = document.querySelector('.customize-total-price');
            const closeCustomize = document.getElementById('closeCustomize');
            const cancelCustomizeBtn = document.getElementById('cancelCustomizeBtn');
            const addToCartBtn = document.getElementById('addToCartBtn');
            const specialRequest = document.querySelector('.special-request-input');
            
            let currentDrink = null;
            let basePrice = 0;
            const toppingPrice = 15; // æ¯é …åŠ æ–™åƒ¹æ ¼
            
            // å®¢è£½åŒ–æŒ‰éˆ•é»æ“Šäº‹ä»¶
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('customize-btn')) {
                    const menuItem = e.target.closest('.menu-item');
                    const drinkName = menuItem.dataset.name;
                    const price = parseFloat(menuItem.dataset.price);
                    
                    currentDrink = drinkName;
                    basePrice = price;
                    
                    // æª¢æŸ¥æ˜¯å¦ç‚ºå’–å•¡é¡é£²æ–™
                    const isCoffee = ['ç¾å¼å’–å•¡', 'æ‹¿éµå’–å•¡'].includes(drinkName);
                    
                    // é¡¯ç¤ºæˆ–éš±è—åŠ æ–™å€ - é™¤äº†å’–å•¡é¡ä¹‹å¤–ï¼Œå…¶ä»–é£²å“éƒ½è¦æœ‰å®¢è£½åŒ–é¸é …
                    const toppingsSection = document.getElementById('toppingsSection');
                    if (toppingsSection) {
                        toppingsSection.style.display = isCoffee ? 'none' : 'block';
                    }
                    
                    // æ ¹æ“šé£²æ–™é¡å‹èª¿æ•´å†°é‡é¸é …
                    const hotOption = document.getElementById('hotOption');
                    const hotDrinks = ['ç¶ èŒ¶', 'ç´…èŒ¶', 'ç¿¡ç¿ ç´…èŒ¶', 'æ˜Ÿè¾°å¥¶èŒ¶', 'ç¾å¼å’–å•¡', 'æ‹¿éµå’–å•¡'];
                    
                    if (hotDrinks.includes(drinkName)) {
                        // é€™äº›é£²æ–™é¡¯ç¤ºç†±é£²é¸é …
                        hotOption.style.display = 'block';
                    } else {
                        // å…¶ä»–é£²æ–™ä¸é¡¯ç¤ºç†±é£²é¸é …
                        hotOption.style.display = 'none';
                        // å¦‚æœç•¶å‰é¸ä¸­çš„æ˜¯"ç†±é£²"ï¼Œå‰‡æ”¹ç‚º"æ­£å¸¸å†°"
                        const hotRadio = document.querySelector('input[name="ice"][value="ç†±é£²"]');
                        if (hotRadio && hotRadio.checked) {
                            document.querySelector('input[name="ice"][value="æ­£å¸¸å†°"]').checked = true;
                        }
                    }
                    
                    // æ›´æ–°å½ˆå‡ºé¢æ¿
                    customizeDrinkName.textContent = `å®¢è£½åŒ– ${drinkName}`;
                    updateTotalPrice();
                    
                    // é¡¯ç¤ºå½ˆå‡ºé¢æ¿
                    customizeModal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            });
            
            // é—œé–‰å®¢è£½åŒ–é¢æ¿
            function closeCustomizeModal() {
                customizeModal.classList.remove('active');
                document.body.style.overflow = 'auto';
                
                // é‡ç½®é¸é …
                document.querySelector('input[name="sugar"][value="ç„¡ç³–"]').checked = true;
                document.querySelector('input[name="ice"][value="æ­£å¸¸å†°"]').checked = true;
                document.querySelectorAll('input[name="toppings"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                specialRequest.value = '';
                
                // é‡æ–°é¡¯ç¤ºåŠ æ–™å€ï¼ˆç‚ºä¸‹æ¬¡æ‰“é–‹åšæº–å‚™ï¼‰
                const toppingsSection = document.getElementById('toppingsSection');
                if (toppingsSection) {
                    toppingsSection.style.display = 'block';
                }
                
                // é‡æ–°éš±è—ç†±é£²é¸é …ï¼ˆç‚ºä¸‹æ¬¡æ‰“é–‹åšæº–å‚™ï¼‰
                const hotOption = document.getElementById('hotOption');
                if (hotOption) {
                    hotOption.style.display = 'none';
                }
                
                currentDrink = null;
                basePrice = 0;
            }
            
            closeCustomize.addEventListener('click', closeCustomizeModal);
            cancelCustomizeBtn.addEventListener('click', closeCustomizeModal);
            
            // é»æ“ŠèƒŒæ™¯é—œé–‰
            customizeModal.addEventListener('click', function(e) {
                if (e.target === customizeModal) {
                    closeCustomizeModal();
                }
            });
            
            // æ›´æ–°ç¸½åƒ¹
            function updateTotalPrice() {
                const selectedToppings = document.querySelectorAll('input[name="toppings"]:checked');
                const toppingsCost = selectedToppings.length * toppingPrice;
                const totalPrice = basePrice + toppingsCost;
                
                customizeTotalPrice.textContent = `NT$ ${totalPrice}`;
            }
            
            // ç›£è½é¸é …è®ŠåŒ–
            document.querySelectorAll('input[name="sugar"], input[name="ice"]').forEach(radio => {
                radio.addEventListener('change', updateTotalPrice);
            });
            
            document.querySelectorAll('input[name="toppings"]').forEach(checkbox => {
                checkbox.addEventListener('change', updateTotalPrice);
            });


            
            // åŠ å…¥è³¼ç‰©è»Š
            addToCartBtn.addEventListener('click', function() {
                if (!currentDrink) return;
                
                const selectedSugar = document.querySelector('input[name="sugar"]:checked').value;
                const selectedIce = document.querySelector('input[name="ice"]:checked').value;
                const selectedToppings = Array.from(document.querySelectorAll('input[name="toppings"]:checked')).map(cb => cb.value);
                const specialReq = specialRequest.value.trim();
                
                const selectedToppingsCost = selectedToppings.length * toppingPrice;
                const totalPrice = basePrice + selectedToppingsCost;
                
                // å‰µå»ºå®¢è£½åŒ–é …ç›®
                const customizedItem = {
                    name: currentDrink,
                    basePrice: basePrice,
                    sugar: selectedSugar,
                    ice: selectedIce,
                    toppings: selectedToppings,
                    specialRequest: specialReq,
                    totalPrice: totalPrice,
                    quantity: 1
                };
                
                // æ·»åŠ åˆ°è³¼ç‰©è»Šï¼ˆéœ€è¦èˆ‡ç¾æœ‰è³¼ç‰©è»Šæ•´åˆï¼‰
                addToCart(customizedItem);
                
                // æ§‹å»ºå®Œæ•´çš„é¡¯ç¤ºè¨Šæ¯
                let displayMessage = `${currentDrink}`;
                
                // æ·»åŠ ç³–é‡è³‡è¨Šï¼ˆé¡¯ç¤ºæ‰€æœ‰é¸æ“‡ï¼‰
                if (selectedSugar) {
                    displayMessage += ` ${selectedSugar}`;
                }
                
                // æ·»åŠ å†°é‡è³‡è¨Šï¼ˆé¡¯ç¤ºæ‰€æœ‰é¸æ“‡ï¼‰
                if (selectedIce) {
                    displayMessage += ` ${selectedIce}`;
                }
                
                // æ·»åŠ åŠ æ–™è³‡è¨Š
                if (selectedToppings && selectedToppings.length > 0) {
                    displayMessage += ` +${selectedToppings.join(',')}`;
                }
                
                // æ·»åŠ ç‰¹æ®Šè¦æ±‚ï¼ˆå¦‚æœæœ‰ï¼‰
                if (specialReq) {
                    displayMessage += ` (${specialReq})`;
                }
                
                displayMessage += ` å·²åŠ å…¥è³¼ç‰©è»Š!`;
                
                // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                showNotification(displayMessage, 'success');
                
                // é—œé–‰é¢æ¿
                closeCustomizeModal();
            });
            
            // æ·»åŠ åˆ°è³¼ç‰©è»Šçš„å‡½æ•¸ï¼ˆéœ€è¦èˆ‡ç¾æœ‰è³¼ç‰©è»Šæ•´åˆï¼‰
            function addToCart(item) {
                // èˆ‡ç¾æœ‰è³¼ç‰©è»ŠåŠŸèƒ½æ•´åˆ
                const id = Date.now().toString(); // ç”Ÿæˆå”¯ä¸€ID
                
                // æ§‹å»ºå•†å“åç¨±ï¼ˆåªé¡¯ç¤ºåŸºæœ¬åç¨±ï¼Œå®¢è£½åŒ–ä¿¡æ¯æ”¾åœ¨customizationså­—æ®µä¸­ï¼‰
                let displayName = item.name;
                
                // ä½¿ç”¨ç¾æœ‰çš„è³¼ç‰©è»ŠåŠŸèƒ½
                const waitForGlobalCart = () => {
                    if (window.addToCart) {
                        // æ§‹å»ºå®¢åˆ¶åŒ–å­—ç¬¦ä¸²
                        let customizations = '';
                        const parts = [];
                        if (item.sugar) parts.push(item.sugar);
                        if (item.ice) parts.push(item.ice);
                        if (item.toppings && item.toppings.length > 0) {
                            parts.push(`+${item.toppings.join(',')}`);
                        }
                        if (item.specialRequest && item.specialRequest.trim()) {
                            parts.push(item.specialRequest);
                            console.log('ğŸ” ç‰¹æ®Šéœ€æ±‚å·²æ·»åŠ :', item.specialRequest);
                        }
                        customizations = parts.join(', ');
                        console.log('ğŸ” æœ€çµ‚å®¢åˆ¶åŒ–å­—ç¬¦ä¸²:', customizations);
                        
                        window.addToCart(displayName, item.totalPrice, customizations, item.specialRequest || '', true);
                    } else {
                        console.log('â³ ç­‰å¾…å…¨å±€è³¼ç‰©è»Šç³»çµ±åˆå§‹åŒ–...');
                        setTimeout(waitForGlobalCart, 100);
                    }
                };
                
                waitForGlobalCart();
            }
            
            // ä½¿ç”¨å…¨å±€çš„ showNotification å‡½æ•¸
        });
    </script>

</body>
</html> 